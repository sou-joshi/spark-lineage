<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>AI Demo Chat</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <a class="btn" href="/">Home</a>
      <span class="badge">AI Demo</span>
      <span style="font-weight:800">Offline “AI Assistant” (Deterministic Demo)</span>
      <span class="badge">Graph: {{graph_key}}</span>
    </div>
  <div class="grid" style="grid-template-columns: 1.8fr 1fr; gap:16px; margin-top:14px">
    <div class="card" style="min-height:72vh">
      <h3 style="margin:0 0 10px 0">Ask a question</h3>
      <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px">
        <input id="q" type="text" placeholder="e.g. How is ORACLE.MART_LATITUDE_DAILY.PING_COUNT calculated?"
               style="flex:1; padding:12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.10); background:rgba(2,6,23,0.55); color:rgba(255,255,255,0.9)"/>
        <a class="btn" id="askBtn" href="#">Ask</a>
      </div>
      <div class="hint" style="margin-bottom:12px">
        Tip: Use fully-qualified dataset/column names for best results.
      </div>

      <div class="card" style="background:rgba(2,6,23,0.35); border:1px solid rgba(255,255,255,0.08)">
        <h4 style="margin:0 0 8px 0">AI response</h4>
        <div id="ans" class="mono" style="white-space:pre-wrap; line-height:1.45; min-height:240px; color:rgba(255,255,255,0.88)"></div>
      </div>

      <div style="height:10px"></div>
      <div class="card" style="background:rgba(2,6,23,0.35); border:1px solid rgba(255,255,255,0.08)">
        <h4 style="margin:0 0 8px 0">References</h4>
        <div id="refs" class="mono" style="white-space:pre-wrap; line-height:1.45; color:rgba(255,255,255,0.78)"></div>
      </div>
    </div>

    <div class="card" style="min-height:72vh">
      <h3 style="margin:0 0 10px 0">Quick actions</h3>
      <div class="hint" style="margin-bottom:10px">Use these to navigate to the right graph pages.</div>
      <div style="display:grid; gap:10px">
        <a class="btn" href="/graph/{graph_key}">Open dataset lineage graph</a>
        <a class="btn" href="/search?g={graph_key}">Search datasets / columns</a>
        <a class="btn" href="/lineage/table/ORACLE.MART_LATITUDE_DAILY?g={graph_key}">Jump to ORACLE.MART_LATITUDE_DAILY</a>
        <a class="btn" href="/lineage/column/ORACLE.MART_LATITUDE_DAILY.PING_COUNT?g={graph_key}">Jump to PING_COUNT lineage</a>
      </div>

      <div style="height:14px"></div>
      <div class="hint">Demo questions are listed in the README (section: AI Demo questions).</div>
    </div>
  </div>
</div>

<script>
async function ask(q){
  const ansEl=document.getElementById("ans");
  const refsEl=document.getElementById("refs");
  ansEl.textContent="Thinking...";
  refsEl.textContent="";
  const r = await fetch("/api/ai/ask", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({graph_key:"{graph_key}", question:q})
  });
  const j = await r.json();
  ansEl.textContent = j.answer || "(no answer)";
  refsEl.textContent = (j.references||[]).join("\n");
}
document.getElementById("askBtn").addEventListener("click",(e)=>{
  e.preventDefault();
  const q=document.getElementById("q").value.trim();
  if(q) ask(q);
});
document.getElementById("q").addEventListener("keydown",(e)=>{
  if(e.key==="Enter") document.getElementById("askBtn").click();
});
</script>

</body>
</html>
